} else {
dt1[, ..cols1][, __rowid := .I]
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_equal <- function(dt1, dt2, key_col) {
stopifnot(is.data.table(dt1), is.data.table(dt2))
stopifnot(identical(sort(names(dt1)), sort(names(dt2))))
# Zet volgorde kolommen gelijk
setcolorder(dt2, names(dt1))
# Sorteer op key_col zodat rijen overeenkomen
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
# Alleen gemeenschappelijke keys vergelijken
common_keys <- intersect(dt1[[key_col]], dt2[[key_col]])
dt1_common <- dt1[get(key_col) %in% common_keys]
dt2_common <- dt2[get(key_col) %in% common_keys]
# Bepaal verschillen per kolom
unequal_matrix <- dt1_common != dt2_common
unequal_any <- rowSums(unequal_matrix) > 0
# Selecteer alleen rijen én kolommen die verschillen
differing_rows <- which(unequal_any)
differing_cols <- which(colSums(unequal_matrix) > 0)
if (length(differing_rows) == 0) {
return(data.table())
}
# Resultaat: beide tabellen met alleen de verschillen
return(list(
dt1_diff = dt1_common[differing_rows, ..differing_cols],
dt2_diff = dt2_common[differing_rows, ..differing_cols],
differing_rows = dt1_common[differing_rows, ..key_col],
differing_cols = names(dt1)[differing_cols]
))
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_equal(dt1, dt2, key_col = "id")
dt1
dt2
compare_data_tables_diff_long <- function(dt1, dt2, key_col = NULL) {
stopifnot(data.table::is.data.table(dt1), data.table::is.data.table(dt2))
stopifnot(identical(names(dt1), names(dt2)))
common_cols <- names(dt1)
if (!is.null(key_col)) {
stopifnot(key_col %in% common_cols)
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
dt1 <- dt1[dt2, on = key_col, nomatch = 0, allow.cartesian = TRUE]
dt2 <- dt2[dt1, on = key_col, nomatch = 0, allow.cartesian = TRUE]
}
# Detect verschillen per kolom en rij
diff_list <- lapply(common_cols, function(col) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
neq <- which(!(is.na(v1) & is.na(v2)) & (is.na(v1) | is.na(v2) | v1 != v2))
if (length(neq) > 0) {
data.table::data.table(
row = neq,
kolom = col,
waarde_dt1 = v1[neq],
waarde_dt2 = v2[neq]
)
} else {
NULL
}
})
# Combineer tot 1 lange data.table
res <- data.table::rbindlist(diff_list, use.names = TRUE, fill = TRUE)
# Als key_col is opgegeven, voeg die toe voor interpretatie
if (!is.null(key_col) && nrow(res) > 0) {
res[, (key_col) := dt1[[key_col]][res$row]]
data.table::setcolorder(res, c(key_col, "row", "kolom", "waarde_dt1", "waarde_dt2"))
}
res[]
}
compare_data_tables_diff_long(dt1, dt2, key_col = "id")
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_equal <- function(dt1, dt2, key_col) {
stopifnot(is.data.table(dt1), is.data.table(dt2))
stopifnot(identical(sort(names(dt1)), sort(names(dt2))))
# Zet volgorde kolommen gelijk
setcolorder(dt2, names(dt1))
# Sorteer op key_col zodat rijen overeenkomen
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
# Alleen gemeenschappelijke keys vergelijken
common_keys <- intersect(dt1[[key_col]], dt2[[key_col]])
dt1_common <- dt1[get(key_col) %in% common_keys]
dt2_common <- dt2[get(key_col) %in% common_keys]
# Bepaal verschillen per kolom
unequal_matrix <- dt1_common != dt2_common
unequal_any <- rowSums(unequal_matrix) > 0
# Selecteer alleen rijen én kolommen die verschillen
differing_rows <- which(unequal_any)
differing_cols <- which(colSums(unequal_matrix) > 0)
if (length(differing_rows) == 0) {
return(data.table())
}
# Resultaat: beide tabellen met alleen de verschillen
return(list(
dt1_diff = dt1_common[differing_rows, ..differing_cols],
dt2_diff = dt2_common[differing_rows, ..differing_cols],
differing_rows = dt1_common[differing_rows, ..key_col],
differing_cols = names(dt1)[differing_cols]
))
}
compare_data_tables_diff_long <- function(dt1, dt2, key_col = NULL) {
stopifnot(data.table::is.data.table(dt1), data.table::is.data.table(dt2))
stopifnot(identical(names(dt1), names(dt2)))
common_cols <- names(dt1)
if (!is.null(key_col)) {
stopifnot(key_col %in% common_cols)
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
dt1 <- dt1[dt2, on = key_col, nomatch = 0, allow.cartesian = TRUE]
dt2 <- dt2[dt1, on = key_col, nomatch = 0, allow.cartesian = TRUE]
}
# Detect verschillen per kolom en rij
diff_list <- lapply(common_cols, function(col) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
neq <- which(!(is.na(v1) & is.na(v2)) & (is.na(v1) | is.na(v2) | v1 != v2))
if (length(neq) > 0) {
data.table::data.table(
row = neq,
kolom = col,
waarde_dt1 = v1[neq],
waarde_dt2 = v2[neq]
)
} else {
NULL
}
})
# Combineer tot 1 lange data.table
res <- data.table::rbindlist(diff_list, use.names = TRUE, fill = TRUE)
# Als key_col is opgegeven, voeg die toe voor interpretatie
if (!is.null(key_col) && nrow(res) > 0) {
res[, (key_col) := dt1[[key_col]][res$row]]
data.table::setcolorder(res, c(key_col, "row", "kolom", "waarde_dt1", "waarde_dt2"))
}
res[]
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_equal(dt1, dt2, key_col = "id")
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_diff_long <- function(dt1, dt2, key_col = NULL) {
stopifnot(data.table::is.data.table(dt1), data.table::is.data.table(dt2))
stopifnot(identical(names(dt1), names(dt2)))
common_cols <- names(dt1)
if (!is.null(key_col)) {
stopifnot(key_col %in% common_cols)
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
dt1 <- dt1[dt2, on = key_col, nomatch = 0, allow.cartesian = TRUE]
dt2 <- dt2[dt1, on = key_col, nomatch = 0, allow.cartesian = TRUE]
}
# Detect verschillen per kolom en rij
diff_list <- lapply(common_cols, function(col) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
neq <- which(!(is.na(v1) & is.na(v2)) & (is.na(v1) | is.na(v2) | v1 != v2))
if (length(neq) > 0) {
data.table::data.table(
row = neq,
kolom = col,
waarde_dt1 = v1[neq],
waarde_dt2 = v2[neq]
)
} else {
NULL
}
})
# Combineer tot 1 lange data.table
res <- data.table::rbindlist(diff_list, use.names = TRUE, fill = TRUE)
# Als key_col is opgegeven, voeg die toe voor interpretatie
if (!is.null(key_col) && nrow(res) > 0) {
res[, (key_col) := dt1[[key_col]][res$row]]
data.table::setcolorder(res, c(key_col, "row", "kolom", "waarde_dt1", "waarde_dt2"))
}
res[]
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_diff_long(dt1, dt2, key_col = "id")
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_equal <- function(dt1, dt2) {
stopifnot(is.data.table(dt1), is.data.table(dt2))
# Check structure
if (!identical(names(dt1), names(dt2))) stop("Kolomnamen verschillen.")
if (nrow(dt1) != nrow(dt2)) stop("Aantal rijen verschilt.")
dt1_list <- as.list(dt1)
dt2_list <- as.list(dt2)
res_list <- list()
for (col in names(dt1)) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
unequal <- !(is.na(v1) & is.na(v2)) & (v1 != v2 | xor(is.na(v1), is.na(v2)))
if (any(unequal)) {
rows <- which(unequal)
dt1_labels <- paste0("dt1[", rows, ",\"", col, "\"]")
dt2_labels <- paste0("dt2[", rows, ",\"", col, "\"]")
res_list[[col]] <- data.table::data.table(
structure(
list(
setNames(v1[rows], dt1_labels),
setNames(v2[rows], dt2_labels)
),
names = c("value_dt1", "value_dt2")
)
)
}
}
if (length(res_list) == 0) return(data.table::data.table())
result <- data.table::rbindlist(res_list, fill = TRUE)
return(result)
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
dt1
dt2
compare_data_tables_diff_long(dt1, dt2, key_col = "id")
compare_data_tables_equal(dt1, dt2, key_col = "id")
compare_data_tables_equal(dt1, dt2)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_equal(dt1, dt2)
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_equal <- function(dt1, dt2) {
stopifnot(is.data.table(dt1), is.data.table(dt2))
# Check structure
if (!identical(names(dt1), names(dt2))) stop("Kolomnamen verschillen.")
if (nrow(dt1) != nrow(dt2)) stop("Aantal rijen verschilt.")
dt1_list <- as.list(dt1)
dt2_list <- as.list(dt2)
res_list <- list()
for (col in names(dt1)) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
unequal <- !(is.na(v1) & is.na(v2)) & (v1 != v2 | xor(is.na(v1), is.na(v2)))
if (any(unequal)) {
rows <- which(unequal)
dt1_labels <- paste0("dt1[", rows, ",\"", col, "\"]")
dt2_labels <- paste0("dt2[", rows, ",\"", col, "\"]")
res_list[[col]] <- data.table::data.table(
structure(
list(
setNames(v1[rows], dt1_labels),
setNames(v2[rows], dt2_labels)
),
names = c("value_dt1", "value_dt2")
)
)
}
}
if (length(res_list) == 0) return(data.table::data.table())
result <- data.table::rbindlist(res_list, fill = TRUE)
return(result)
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
dt1
dt2
compare_data_tables_equal(dt1, dt2)
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_equal <- function(dt1, dt2) {
stopifnot(is.data.table(dt1), is.data.table(dt2))
# Check structure
if (!identical(names(dt1), names(dt2))) stop("Kolomnamen verschillen.")
if (nrow(dt1) != nrow(dt2)) stop("Aantal rijen verschilt.")
dt1_list <- as.list(dt1)
dt2_list <- as.list(dt2)
res_list <- list()
for (col in names(dt1)) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
unequal <- !(is.na(v1) & is.na(v2)) & (v1 != v2 | xor(is.na(v1), is.na(v2)))
if (any(unequal)) {
rows <- which(unequal)
dt1_labels <- paste0("dt1[", rows, ",\"", col, "\"]")
dt2_labels <- paste0("dt2[", rows, ",\"", col, "\"]")
res_list[[col]] <- data.table::data.table(
structure(
list(
setNames(v1[rows], dt1_labels),
setNames(v2[rows], dt2_labels)
),
names = c("value_dt1", "value_dt2")
)
)
}
}
if (length(res_list) == 0) return(data.table::data.table())
result <- data.table::rbindlist(res_list, fill = TRUE)
return(result)
}
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_equal(dt1, dt2, key_col = "id")
compare_data_tables_equal(dt1, dt2)
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_diff_long <- function(dt1, dt2, key_col = NULL) {
stopifnot(data.table::is.data.table(dt1), data.table::is.data.table(dt2))
stopifnot(identical(names(dt1), names(dt2)))
common_cols <- names(dt1)
if (!is.null(key_col)) {
stopifnot(key_col %in% common_cols)
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
dt1 <- dt1[dt2, on = key_col, nomatch = 0, allow.cartesian = TRUE]
dt2 <- dt2[dt1, on = key_col, nomatch = 0, allow.cartesian = TRUE]
}
# Detect verschillen per kolom en rij
diff_list <- lapply(common_cols, function(col) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
neq <- which(!(is.na(v1) & is.na(v2)) & (is.na(v1) | is.na(v2) | v1 != v2))
if (length(neq) > 0) {
data.table::data.table(
row = neq,
kolom = col,
waarde_dt1 = v1[neq],
waarde_dt2 = v2[neq]
)
} else {
NULL
}
})
# Combineer tot 1 lange data.table
res <- data.table::rbindlist(diff_list, use.names = TRUE, fill = TRUE)
# Als key_col is opgegeven, voeg die toe voor interpretatie
if (!is.null(key_col) && nrow(res) > 0) {
res[, (key_col) := dt1[[key_col]][res$row]]
data.table::setcolorder(res, c(key_col, "row", "kolom", "waarde_dt1", "waarde_dt2"))
}
res[]
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_diff_long(dt1, dt2, key_col = "id")
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_diff_long <- function(dt1, dt2, key_col = NULL) {
stopifnot(data.table::is.data.table(dt1), data.table::is.data.table(dt2))
stopifnot(identical(names(dt1), names(dt2)))
common_cols <- names(dt1)
if (!is.null(key_col)) {
stopifnot(key_col %in% common_cols)
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
dt1 <- dt1[dt2, on = key_col, nomatch = 0, allow.cartesian = TRUE]
dt2 <- dt2[dt1, on = key_col, nomatch = 0, allow.cartesian = TRUE]
}
# Detect verschillen per kolom en rij
diff_list <- lapply(common_cols, function(col) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
neq <- which(!(is.na(v1) & is.na(v2)) & (is.na(v1) | is.na(v2) | v1 != v2))
if (length(neq) > 0) {
data.table::data.table(
row = neq,
kolom = col,
waarde_dt1 = v1[neq],
waarde_dt2 = v2[neq]
)
} else {
NULL
}
})
# Combineer tot 1 lange data.table
res <- data.table::rbindlist(diff_list, use.names = TRUE, fill = TRUE)
# Als key_col is opgegeven, voeg die toe voor interpretatie
if (!is.null(key_col) && nrow(res) > 0) {
res[, (key_col) := dt1[[key_col]][res$row]]
data.table::setcolorder(res, c(key_col, "rij", "kolom", "dt1", "dt2"))
}
res[]
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_diff_long(dt1, dt2, key_col = "id")
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_diff_long <- function(dt1, dt2, key_col = NULL) {
stopifnot(data.table::is.data.table(dt1), data.table::is.data.table(dt2))
stopifnot(identical(names(dt1), names(dt2)))
common_cols <- names(dt1)
if (!is.null(key_col)) {
stopifnot(key_col %in% common_cols)
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
dt1 <- dt1[dt2, on = key_col, nomatch = 0, allow.cartesian = TRUE]
dt2 <- dt2[dt1, on = key_col, nomatch = 0, allow.cartesian = TRUE]
}
# Detect verschillen per kolom en rij
diff_list <- lapply(common_cols, function(col) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
neq <- which(!(is.na(v1) & is.na(v2)) & (is.na(v1) | is.na(v2) | v1 != v2))
if (length(neq) > 0) {
data.table::data.table(
row = neq,
kolom = col,
waarde_dt1 = v1[neq],
waarde_dt2 = v2[neq]
)
} else {
NULL
}
})
# Combineer tot 1 lange data.table
res <- data.table::rbindlist(diff_list, use.names = TRUE, fill = TRUE)
# Als key_col is opgegeven, voeg die toe voor interpretatie
if (!is.null(key_col) && nrow(res) > 0) {
res[, (key_col) := dt1[[key_col]][res$row]]
data.table::setcolorder(res, c(key_col, "row", "kolom", "waarde_dt1", "waarde_dt2"))
}
res[]
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_diff_long(dt1, dt2, key_col = "id")
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_diff_long <- function(dt1, dt2, key_col = NULL) {
stopifnot(data.table::is.data.table(dt1), data.table::is.data.table(dt2))
stopifnot(identical(names(dt1), names(dt2)))
common_cols <- names(dt1)
if (!is.null(key_col)) {
stopifnot(key_col %in% common_cols)
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
dt1 <- dt1[dt2, on = key_col, nomatch = 0, allow.cartesian = TRUE]
dt2 <- dt2[dt1, on = key_col, nomatch = 0, allow.cartesian = TRUE]
}
# Detect verschillen per kolom en rij
diff_list <- lapply(common_cols, function(col) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
neq <- which(!(is.na(v1) & is.na(v2)) & (is.na(v1) | is.na(v2) | v1 != v2))
if (length(neq) > 0) {
data.table::data.table(
row = neq,
kolom = col,
waarde_dt1 = v1[neq],
waarde_dt2 = v2[neq]
)
} else {
NULL
}
})
# Combineer tot 1 lange data.table
res <- data.table::rbindlist(diff_list, use.names = TRUE, fill = TRUE)
# Als key_col is opgegeven, voeg die toe voor interpretatie
if (!is.null(key_col) && nrow(res) > 0) {
res[, (key_col) := dt1[[key_col]][res$row]]
data.table::setcolorder(res, c(key_col, "row", "kolom", "dt1", "dt2"))
}
res[]
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_diff_long(dt1, dt2, key_col = "id")
# Vergelijk of twee data.tables exact gelijk zijn, ongeacht rijvolgorde
compare_data_tables_diff_long <- function(dt1, dt2, key_col = NULL) {
stopifnot(data.table::is.data.table(dt1), data.table::is.data.table(dt2))
stopifnot(identical(names(dt1), names(dt2)))
common_cols <- names(dt1)
if (!is.null(key_col)) {
stopifnot(key_col %in% common_cols)
setkeyv(dt1, key_col)
setkeyv(dt2, key_col)
dt1 <- dt1[dt2, on = key_col, nomatch = 0, allow.cartesian = TRUE]
dt2 <- dt2[dt1, on = key_col, nomatch = 0, allow.cartesian = TRUE]
}
# Detect verschillen per kolom en rij
diff_list <- lapply(common_cols, function(col) {
v1 <- dt1[[col]]
v2 <- dt2[[col]]
neq <- which(!(is.na(v1) & is.na(v2)) & (is.na(v1) | is.na(v2) | v1 != v2))
if (length(neq) > 0) {
data.table::data.table(
row = neq,
kolom = col,
waarde_dt1 = v1[neq],
waarde_dt2 = v2[neq]
)
} else {
NULL
}
})
# Combineer tot 1 lange data.table
res <- data.table::rbindlist(diff_list, use.names = TRUE, fill = TRUE)
# Als key_col is opgegeven, voeg die toe voor interpretatie
if (!is.null(key_col) && nrow(res) > 0) {
res[, (key_col) := dt1[[key_col]][res$row]]
data.table::setcolorder(res, c(key_col, "row", "kolom", "waarde_dt1", "waarde_dt2"))
}
res[]
}
library(data.table)
dt1 <- data.table(id = 1:3, x = c(1, 2, 3), y = c("a", "b", "c"))
dt2 <- data.table(id = 1:3, x = c(1, 99, 3), y = c("a", "b", "z"))
compare_data_tables_diff_long(dt1, dt2, key_col = "id")
getwd()
